<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head
	th:replace="~{admin/fragments :: head(title='Gestión de Consultas')}"></head>

<body style="background: #f8f9fa;">

	<div class="admin-wrapper">

		<nav th:replace="~{admin/fragments :: admin-sidebar}"></nav>

		<div class="admin-content">
			<div class="container-fluid py-4">

				<div class="d-flex justify-content-between align-items-center mb-4">
					<h2 class="fw-bold" style="color: var(--deep-love);">
						<i class="bi bi-person-workspace me-2"></i>Gestión de Consultas
					</h2>
					<div class="d-flex gap-2">
						<span
							class="badge bg-white text-dark border px-3 py-2 rounded-pill shadow-sm">
							<i class="bi bi-envelope-paper me-1"></i> <span
							th:text="${#lists.size(consultas)}">0</span> Mensajes
						</span> <a href="/productos"
							class="btn btn-outline-secondary btn-sm rounded-pill shadow-sm">Ver
							Sitio Público</a>
					</div>
				</div>

				<div class="card border-0 shadow-sm rounded-4 overflow-hidden">
					<div class="table-responsive">
						<table class="table table-hover align-middle mb-0">
							<thead class="table-dark">
								<tr>
									<th class="ps-4">Fecha</th>
									<th>Cliente</th>
									<th>Plan Interés</th>
									<th>Mensaje</th>
									<th class="text-center">Acciones</th>
									<th>Estado</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="c : ${consultas}">
									<td class="ps-4"><small class="text-muted fw-bold"
										th:text="${#temporals.format(c.fechaEnvio, 'dd/MM/yyyy HH:mm')}"></small>
									</td>
									<td>
										<div class="fw-bold text-dark" th:text="${c.nombre}">Nombre</div>
										<div class="small text-muted" th:text="${c.email}">email@test.com</div>
									</td>
									<td><span th:if="${c.plan != null}"
										class="badge bg-info-subtle text-info border border-info-subtle px-3"
										th:text="${c.plan.nombre}"></span> <span
										th:unless="${c.plan != null}"
										class="badge bg-secondary-subtle text-secondary px-3">General</span>
									</td>
									<td>
										<p class="mb-0 small text-truncate" style="max-width: 250px;"
											th:text="${c.mensaje}"></p>
									</td>
									<td><span th:if="${c.respuesta == null}"
										class="badge bg-warning text-dark rounded-pill">Pendiente</span>
										<span th:if="${c.respuesta != null}"
										class="badge bg-success rounded-pill">Respondida</span></td>
									<td class="text-center">
										<button
											class="btn btn-sm btn-romance rounded-pill px-3 shadow-sm"
											data-bs-toggle="modal"
											th:data-bs-target="'#modalMsg' + ${c.id}">
											<i class="bi bi-eye-fill me-1"></i> Leer
										</button>
									</td>
								</tr>
								<tr th:if="${#lists.isEmpty(consultas)}">
									<td colspan="5" class="text-center py-5 text-muted italic">
										<i class="bi bi-inbox fs-1 d-block mb-2"></i> No se han
										recibido consultas todavía.
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div th:each="c : ${consultas}" class="modal fade"
		th:id="'modalMsg' + ${c.id}" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content border-0 shadow-lg rounded-4">
				<div class="modal-header bg-light border-0">
					<h5 class="modal-title fw-bold" style="color: var(--deep-love);">Detalle
						de Consulta</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body p-4">
					<div class="mb-3">
						<label class="text-muted small d-block">Cliente</label> <strong
							th:text="${c.nombre} + ' (' + ${c.email} + ')'"></strong>
					</div>
					<div class="mb-3">
						<label class="text-muted small d-block">Interesado en:</label> <span
							class="badge bg-info text-dark"
							th:text="${c.plan != null ? c.plan.nombre : 'Consulta General'}"></span>
					</div>
					<div class="mb-1">
						<label class="text-muted small d-block">Mensaje:</label>
						<div class="p-3 bg-light rounded-3 fst-italic shadow-inner"
							th:text="${c.mensaje}"></div>
					</div>
				</div>
				<div class="modal-body p-4">
					<div class="mb-3">
						<label class="text-muted small d-block">Mensaje:</label>
						<div class="p-3 bg-light rounded-3 fst-italic shadow-inner mb-3"
							th:text="${c.mensaje}"></div>
					</div>

					<form th:action="@{/admin/consultas/responder}" method="post">
						<input type="hidden" name="consultaId" th:value="${c.id}">

						<div class="mb-3">
							<label class="fw-bold small mb-2"
								style="color: var(--deep-love);">Tu Respuesta:</label>
							<textarea class="form-control rounded-3" name="respuesta"
								rows="4" required placeholder="Escribe tu respuesta aquí..."
								th:text="${c.respuesta}"></textarea>
						</div>

						<div class="modal-footer border-0 px-0 pb-0">
							<button type="button" class="btn btn-light rounded-pill"
								data-bs-dismiss="modal">Cerrar</button>
							<button type="submit" class="btn btn-success rounded-pill px-4">
								<i class="bi bi-send-fill me-1"></i> Guardar y Enviar
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>